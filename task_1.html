<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <h1>Вариант 5</h1> 
  <p>Решить квадратное уравнение.</p>    
  <p>Квадратное уравнение — уравнение вида ax² + bx + c = 0, где a, b, c — некоторые числа (a ≠ 0), x — неизвестное.</p>
 
  <pre>
    function(a: Number, b: Number, c: Number, cb: (result1?: Number, result2?: Number) => void) {

    }
  </pre>
  
  <p style="color: red">Вывод тестов в консоль браузера</p>

  <script src="shri-async-hw.js"></script>

  <script>
    const {
        AsyncArray,
        add,
        subtract,
        multiply,
        divide,
        mod,
        less,
        equal,
        lessOrEqual,
        sqrt
    } = Homework;

    
    function solveQuadratic(a, b, c) {
      // ax² + bx + c = 0

      return new Promise((resolve, reject) => {

        if (!a) a = 1;
        if (!b && b != 0) b = 1;
        if (!c && c != 0) c = 1;

        if (Number.isInteger(a) && Number.isInteger(b) && Number.isInteger(c)) resolve([a, b, c]);
        else reject("Ошибка: если вы вводите коэффициенты, они должны быть числами и первый коэффициент должен быть отличен от 0");


      }).then(values => {

        // чтобы найти дискриминант D = b² - 4ac, выполняем параллельно b*b и 4*a*c
        Promise.all([

          new Promise(resolve => {
            // b*b
            multiply(b, b, (result) => resolve(result))
            
          }),

          new Promise(resolve => {
            // a*c
            multiply(a, c, (result) => resolve(result))

          }).then(value => {
            // 4 * (ac)
            return new Promise((resolve) => {
              multiply(value, 4, (result) => resolve(result))
            })
            
          })
          
        ]).then(values => {
          // затем из 1ого результата вычитаем 2ой
          return new Promise((resolve) => {
            // b² - 4ac
            subtract(values[0], values[1], (result) => resolve(result))

          })
        }).then(value => {
            // console.log("D = ", value);
            // сравниваем D с 0
            return new Promise((resolve, reject) => {
              
              equal(value, 0, (result) => resolve(result))
              
            }).then(result => {              
                // если D === 0
                // то 1 корень: x = -b / 2*a
                if (result) {

                  Promise.all([
                    new Promise(resolve => {

                      multiply(b, -1, (result) => resolve(result))
                      
                    }), 
                    new Promise(resolve => {

                      multiply(a, 2, (result) => resolve(result))

                    })                  
                  ]).then(values => {

                    return new Promise((resolve) => {

                      divide(values[0], values[1], (result) => resolve(result))

                    })

                  }).then(value => console.log('%c Уравнение: ' + a + 'x² + ' + b + 'x + ' + c + ' = 0. Дискриминант: 0. Корень уравнения: ' + value, 'color: olive; font-size: 1.2em') )

                } else {
                  // если D !== 0
                  return new Promise((resolve) => {
                    // проверяем, если D < 0
                    less(value, 0, (result) => resolve(result))   

                  }).then(result => {
        
                    // если D < 0
                    if (result) {
                      console.log('%c Уравнение: ' + a + 'x² + ' + b + 'x + ' + c + ' = 0. Дискриминант: < 0. Корней нет.', 'color: crimson; font-size: 1.2em');
                    } else {
                    // если D > 0    
                      Promise.all([
                        new Promise(resolve => {
                          // корень из D 
                          sqrt(value, (result) => resolve(result))
                          
                        }), 
                        new Promise(resolve => {
                          // b* -1
                          multiply(b, -1, (result) => resolve(result))

                        })                  
                      ]).then(values => {
                    
                        Promise.all([
                          new Promise(resolve => {
                            // -b - sqrt(D)
                            subtract(values[1], values[0], (result) => resolve(result))
                            
                          }), 
                          new Promise(resolve => {
                            // -b + sqrt(D)
                            add(values[1], values[0], (result) => resolve(result))

                          }),
                          new Promise(resolve => {
                            // 2 * a
                            multiply(a, 2, (result) => resolve(result))

                          })      

                        ]).then(values => {

                          Promise.all([
                            new Promise(resolve => {
                              // (-b - sqrt(d)) / 2a 
                              divide(values[0], values[2], (result) => resolve(result))
                              
                            }), 
                            new Promise(resolve => {
                              // (-b + sqrt(d)) / 2a 
                              divide(values[1], values[2], (result) => resolve(result))

                            })                  
                          ])
                          .then(values => {
                            console.log('%c Уравнение: ' + a + 'x² + ' + b + 'x + ' + c + ' = 0. Дискриминант: > 0. Два корня: ' + values[0] + ', ' + values[1], 'color: navy; font-size: 1.2em')
                          })

                        })

                      })
                    }  
                    
                  })

                }
        
              }
            )       

        }) 

      }).catch(err => console.log(err))
    }

    solveQuadratic('ff', 0, 0) // error
    solveQuadratic(1, 2, 1) // D === 0
    solveQuadratic(-1, -1, -1) // D === 0
    solveQuadratic(1, 2, 3) // D < 0
    solveQuadratic(1, 3, 2) // D > 0    
    solveQuadratic(1, 3, -8) // D > 0
    solveQuadratic(-21, -13, -1) // D > 0

  </script>
</body>
</html>